# ChatMate - æ¥ä¸‹æ¥çš„æ“ä½œæ­¥éª¤

## âœ… å·²å®Œæˆ

1. âœ… åˆ›å»ºäº† `LibLlama.swift` - llama.cpp çš„ Swift å°è£…å±‚
2. âœ… æ›´æ–°äº† `LLMService.swift` - ä» Ollama API æ”¹ä¸ºç›´æ¥è°ƒç”¨ llama.cpp
3. âœ… æ‰€æœ‰ä»£ç æ–‡ä»¶å·²å‡†å¤‡å°±ç»ªï¼Œæ— ç¼–è¯‘é”™è¯¯

## ğŸ”§ éœ€è¦åœ¨ Xcode ä¸­æ‰‹åŠ¨å®Œæˆçš„æ“ä½œ

### ç¬¬ä¸€æ­¥ï¼šæ·»åŠ  llama.cpp Package ä¾èµ–

1. **æ‰“å¼€ Xcode é¡¹ç›®**
   ```bash
   open ChatMate/ChatMate.xcodeproj
   ```

2. **æ·»åŠ  Package Dependencies**
   - ç‚¹å‡»èœå•ï¼š`File` â†’ `Add Package Dependencies...`
   - åœ¨æœç´¢æ¡†è¾“å…¥ï¼š`https://github.com/ggerganov/llama.cpp`
   - ç‚¹å‡» `Add Package` å¹¶ç­‰å¾…ä¸‹è½½
   - é€‰æ‹©äº§å“ï¼šå‹¾é€‰ `llama`
   - ç‚¹å‡» `Add Package`

   **âš ï¸ è¿™ä¸€æ­¥å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…**

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ æ¨¡å‹æ–‡ä»¶ï¼ˆä¸‰ç§æ–¹å¼é€‰ä¸€ç§ï¼‰

#### æ–¹å¼ Aï¼šæ‰“åŒ…åˆ° Appï¼ˆæœ€ç®€å•ï¼Œä½† App ä½“ç§¯å¤§ï¼‰

1. åœ¨ Xcode ä¸­ï¼Œå³é”®ç‚¹å‡» `ChatMate/ChatMate` æ–‡ä»¶å¤¹
2. é€‰æ‹© `New Group`ï¼Œå‘½åä¸º `Resources`
3. å°†æ¨¡å‹æ–‡ä»¶æ‹–å…¥ï¼ˆä½äºï¼š`~/Downloads/ChatMate-Models/qwen2.5-1.5b-instruct-q4_k_m.gguf`ï¼‰
4. ç¡®ä¿å‹¾é€‰ï¼š
   - âœ… Copy items if needed
   - âœ… ChatMate (Target)
5. ä¿®æ”¹ `ChatMateApp.swift`ï¼š

```swift
import SwiftUI

@main
struct ChatMateApp: App {
    @StateObject private var chatViewModel = ChatViewModel()
    
    var body: some Scene {
        WindowGroup {
            ChatView()
                .environmentObject(chatViewModel)
                .task {
                    if let modelPath = Bundle.main.path(
                        forResource: "qwen2.5-1.5b-instruct-q4_k_m",
                        ofType: "gguf"
                    ) {
                        await chatViewModel.initialize(modelPath: modelPath)
                    }
                }
        }
    }
}
```

**ä¼˜ç‚¹**ï¼šç”¨æˆ·å®‰è£…å³ç”¨  
**ç¼ºç‚¹**ï¼šApp ä½“ç§¯ +1GB

#### æ–¹å¼ Bï¼šç”¨æˆ·æ‰‹åŠ¨å¯¼å…¥ï¼ˆæœ€çµæ´»ï¼Œæ¨èï¼‰

æš‚æ—¶å…ˆç”¨ç»å¯¹è·¯å¾„æµ‹è¯•ï¼š

```swift
// ChatMateApp.swift
import SwiftUI

@main
struct ChatMateApp: App {
    @StateObject private var chatViewModel = ChatViewModel()
    
    var body: some Scene {
        WindowGroup {
            ChatView()
                .environmentObject(chatViewModel)
                .task {
                    // ä¸´æ—¶ä½¿ç”¨ç»å¯¹è·¯å¾„æµ‹è¯•
                    let modelPath = "/Users/yinlu/Downloads/ChatMate-Models/qwen2.5-1.5b-instruct-q4_k_m.gguf"
                    if FileManager.default.fileExists(atPath: modelPath) {
                        await chatViewModel.initialize(modelPath: modelPath)
                    } else {
                        print("æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨ï¼š\(modelPath)")
                    }
                }
        }
    }
}
```

**âš ï¸ æ³¨æ„**ï¼šè¿™åªèƒ½åœ¨æ¨¡æ‹Ÿå™¨ä¸Šæµ‹è¯•ï¼ŒçœŸæœºéœ€è¦å°†æ¨¡å‹æ–‡ä»¶æ”¾å…¥ App çš„æ²™ç›’ç›®å½•

#### æ–¹å¼ Cï¼šé¦–æ¬¡å¯åŠ¨ä¸‹è½½

éœ€è¦é¢å¤–å®ç°ä¸‹è½½é€»è¾‘ï¼Œæš‚ä¸æ¨èï¼ˆé™¤éä½ æœ‰æœåŠ¡å™¨æ‰˜ç®¡æ¨¡å‹æ–‡ä»¶ï¼‰

### ç¬¬ä¸‰æ­¥ï¼šç¼–è¯‘å’Œè¿è¡Œ

1. **é€‰æ‹©è¿è¡Œç›®æ ‡**
   - æ¨¡æ‹Ÿå™¨ï¼š`iPhone 15 Pro` æˆ– `iPhone 16 Pro`ï¼ˆæ¨èï¼Œå†…å­˜è¶³å¤Ÿï¼‰
   - çœŸæœºï¼šä»»ä½• iPhoneï¼ˆéœ€è¦å…ˆå°†æ¨¡å‹æ‰“åŒ…åˆ° Appï¼‰

2. **ç¼–è¯‘**
   - å¿«æ·é”®ï¼š`âŒ˜ + B`
   - ç­‰å¾…ç¼–è¯‘å®Œæˆ

3. **è¿è¡Œ**
   - å¿«æ·é”®ï¼š`âŒ˜ + R`
   - é¦–æ¬¡å¯åŠ¨ä¼šåŠ è½½æ¨¡å‹ï¼ˆ3-10ç§’ï¼‰

4. **æµ‹è¯•å¯¹è¯**
   - è¾“å…¥ï¼š"ä½ å¥½"
   - æŸ¥çœ‹ AI æ˜¯å¦æµå¼å›å¤

## ğŸ“Š é¢„æœŸæ•ˆæœ

### æ§åˆ¶å°æ—¥å¿—ï¼š
```
å¼€å§‹åŠ è½½æ¨¡å‹: /path/to/qwen2.5-1.5b-instruct-q4_k_m.gguf
Using 4 threads
Attempting to complete "ä½ å¥½"
æ¨¡å‹åŠ è½½æˆåŠŸ: Qwen 1.5B Q4_K_M
```

### UI æ˜¾ç¤ºï¼š
- ç”¨æˆ·æ¶ˆæ¯ç«‹å³æ˜¾ç¤º
- AI å›å¤é€å­—å‡ºç°ï¼ˆæµå¼è¾“å‡ºï¼‰
- å“åº”é€Ÿåº¦ï¼šæ¨¡æ‹Ÿå™¨çº¦ 2-5 tokens/sï¼ŒçœŸæœºçº¦ 5-10 tokens/s

## â— å¯èƒ½é‡åˆ°çš„é—®é¢˜

### 1. Package æ·»åŠ å¤±è´¥

**ç—‡çŠ¶**ï¼šæ˜¾ç¤º `Package.swift doesn't exist`

**è§£å†³**ï¼š
```bash
# æ–¹æ³• 1ï¼šæ¸…ç† SPM ç¼“å­˜
rm -rf ~/Library/Developer/Xcode/DerivedData
rm -rf ~/Library/Caches/org.swift.swiftpm

# æ–¹æ³• 2ï¼šæ‰‹åŠ¨å…‹éš†å¹¶æ·»åŠ ä¸ºæœ¬åœ°åŒ…
cd ~/Downloads
git clone https://github.com/ggerganov/llama.cpp.git
# åœ¨ Xcode ä¸­æ·»åŠ æœ¬åœ°åŒ…ï¼šFile â†’ Add Local...
```

### 2. ç¼–è¯‘é”™è¯¯ï¼š`No such module 'llama'`

**åŸå› **ï¼šPackage æœªæ­£ç¡®é“¾æ¥

**è§£å†³**ï¼š
1. åœ¨ Xcode ä¸­ï¼šProject â†’ ChatMate Target
2. è¿›å…¥ `Build Phases` é€‰é¡¹å¡
3. å±•å¼€ `Link Binary With Libraries`
4. ç‚¹å‡» `+` æ·»åŠ  `llama` åº“

### 3. è¿è¡Œæ—¶é”™è¯¯ï¼š`Could not load model`

**åŸå› **ï¼šæ¨¡å‹æ–‡ä»¶è·¯å¾„ä¸å¯¹

**è§£å†³**ï¼š
```swift
// åœ¨ initialize å‰æ·»åŠ æ£€æŸ¥
print("å°è¯•åŠ è½½æ¨¡å‹ï¼š\(modelPath)")
print("æ–‡ä»¶å­˜åœ¨ï¼š\(FileManager.default.fileExists(atPath: modelPath))")
```

### 4. å´©æºƒï¼šå†…å­˜ä¸è¶³

**åŸå› **ï¼šæ¨¡æ‹Ÿå™¨æˆ–æ—§è®¾å¤‡å†…å­˜ä¸å¤Ÿ

**è§£å†³**ï¼š
- ä½¿ç”¨æ›´æ–°çš„æ¨¡æ‹Ÿå™¨ï¼ˆiPhone 15 Proï¼‰
- å‡å°‘ä¸Šä¸‹æ–‡é•¿åº¦ï¼šä¿®æ”¹ `LibLlama.swift` ä¸­çš„ `n_ctx = 1024`

## ğŸ“– è¯¦ç»†æ–‡æ¡£

æ›´è¯¦ç»†çš„è¯´æ˜è¯·æŸ¥çœ‹ï¼š
- `ä½¿ç”¨llama.cppæ–¹æ¡ˆè¯´æ˜.md` - å®Œæ•´é›†æˆæŒ‡å—
- `iOSé›†æˆllama.cppæ–¹æ¡ˆ.md` - å¤šç§æ–¹æ¡ˆå¯¹æ¯”

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

å®ŒæˆåŸºæœ¬åŠŸèƒ½åï¼Œå¯ä»¥è€ƒè™‘ï¼š
1. å®ç°å¯¹è¯å†å²ç®¡ç†ï¼ˆé™åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦ï¼‰
2. æ·»åŠ æ¨¡å‹ä¸‹è½½åŠŸèƒ½
3. æ”¯æŒå¤šæ¨¡å‹åˆ‡æ¢
4. æ·»åŠ è®¾ç½®é¡µé¢ï¼ˆè°ƒæ•´æ¸©åº¦ã€Top-P ç­‰å‚æ•°ï¼‰
5. å®ç°å¯¹è¯å¯¼å‡ºåŠŸèƒ½

---

**ç°åœ¨è¯·æ‰“å¼€ Xcode å¼€å§‹æ“ä½œï¼** ğŸš€
