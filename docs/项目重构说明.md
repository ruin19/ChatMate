# 项目重构说明

## 🎯 重构目标

1. ✅ 移除嵌套的 `ChatMate/ChatMate/` 目录结构
2. ✅ 将开发文档整理到 `docs/` 目录
3. ✅ 将工具脚本整理到 `scripts/` 目录
4. ✅ 保持代码结构清晰易懂

---

## 📊 重构前后对比

### 重构前 ❌

```
ChatMate/
├── ChatMate/                 # 多余的嵌套层
│   ├── ChatMate.xcodeproj/
│   ├── ChatMate/             # 实际代码在这里
│   │   ├── Models/
│   │   ├── Views/
│   │   └── ...
│   └── llama.xcframework/
├── API变更说明.md            # 文档散落在根目录
├── 真机部署指南.md
├── check_download.sh         # 脚本散落在根目录
├── download_model.py
└── ...
```

### 重构后 ✅

```
ChatMate/
├── ChatMate/                 # 应用代码（单层）
│   ├── Models/
│   ├── Views/
│   ├── ViewModels/
│   ├── Services/
│   ├── Assets.xcassets/
│   └── ChatMateApp.swift
├── ChatMate.xcodeproj/       # Xcode 项目
├── llama.xcframework/        # AI 框架
├── docs/                     # 📚 所有文档
│   ├── 真机部署指南.md
│   ├── 使用预编译XCFramework.md
│   ├── 快速修复步骤.md
│   └── ...
├── scripts/                  # 🔧 所有脚本
│   ├── download_model.py
│   ├── clean_packages.sh
│   └── ...
├── README.md                 # 项目说明
└── .gitignore
```

---

## 🔄 重构步骤

### 1. 扁平化目录结构

```bash
# 移除嵌套的 ChatMate 文件夹
mv ChatMate/ChatMate.xcodeproj ./
mv ChatMate/llama.xcframework ./
mv ChatMate/ChatMate/* ChatMate/
```

### 2. 整理文档

```bash
mkdir docs
mv *.md docs/
mv README.md ./  # README 保留在根目录
```

### 3. 整理脚本

```bash
mkdir scripts
mv *.sh *.py scripts/
```

### 4. 提交更改

```bash
git add -A
git commit -m "🔧 重构项目结构"
```

---

## 📁 新的目录结构详解

### `/ChatMate/` - iOS 应用代码

应用的所有 Swift 代码和资源文件。

**子目录**：
- `Models/` - 数据模型（Message）
- `Views/` - SwiftUI 视图组件
- `ViewModels/` - MVVM 视图模型
- `Services/` - 业务逻辑层（LLMService, LibLlama）
- `Assets.xcassets/` - 图标、颜色等资源

### `/ChatMate.xcodeproj/` - Xcode 项目文件

Xcode 的项目配置文件，包含构建设置、依赖管理等。

### `/llama.xcframework/` - AI 推理引擎

从官方下载的预编译 llama.cpp 框架，支持多平台：
- `ios-arm64/` - 真机（iPhone/iPad）
- `ios-arm64_x86_64-simulator/` - 模拟器

### `/docs/` - 开发文档 📚

所有开发过程中创建的文档：

| 文档 | 说明 |
|------|------|
| `真机部署指南.md` | 如何将 App 部署到真机 |
| `快速修复步骤.md` | 常见问题快速解决 |
| `使用预编译XCFramework.md` | 如何集成 llama.cpp |
| `API变更说明.md` | llama.cpp API 变更记录 |
| `接下来要做的.md` | 开发任务清单 |

### `/scripts/` - 工具脚本 🔧

开发辅助脚本：

| 脚本 | 功能 |
|------|------|
| `download_model.py` | 下载 AI 模型 |
| `clean_packages.sh` | 清理 Swift Package 缓存 |
| `check_download.sh` | 检查模型下载状态 |
| `monitor_download.sh` | 监控下载进度 |

---

## ✅ 重构带来的好处

### 1. 更清晰的结构

- ❌ 之前：`ChatMate/ChatMate/ChatMate/Models/`（三层嵌套）
- ✅ 现在：`ChatMate/Models/`（单层，直观）

### 2. 更好的组织

- 文档集中在 `docs/` 目录
- 脚本集中在 `scripts/` 目录
- 根目录保持简洁

### 3. 更容易导航

新手可以快速找到：
- 代码在哪里？→ `ChatMate/`
- 文档在哪里？→ `docs/`
- 工具在哪里？→ `scripts/`

### 4. 更专业的项目

符合开源项目的标准结构：
```
project/
├── src/         (我们的 ChatMate/)
├── docs/        ✅
├── scripts/     ✅
└── README.md    ✅
```

---

## 🚀 后续维护

### 添加新文档

```bash
# 所有开发文档都放在 docs/ 目录
touch docs/新功能说明.md
```

### 添加新脚本

```bash
# 所有工具脚本都放在 scripts/ 目录
touch scripts/new_tool.sh
chmod +x scripts/new_tool.sh
```

### Git 提交

```bash
git add docs/新文档.md
git commit -m "📝 添加新文档"
```

---

## 📝 注意事项

### Xcode 项目不受影响

虽然文件移动了，但 Xcode 项目文件（`.pbxproj`）中的引用路径是相对的，所以：
- ✅ Xcode 可以正常打开项目
- ✅ 编译和运行不受影响
- ✅ 模拟器和真机都正常

### Git 历史保留完整

使用 `git mv` 或 `git add -A` 后，Git 会追踪文件移动：
- ✅ 文件历史完整保留
- ✅ Blame 信息不丢失
- ✅ 可以正常回溯

---

## 🎉 总结

通过这次重构，项目结构变得：
- ✅ **更清晰**：去除了多余的嵌套
- ✅ **更整洁**：文档和脚本分类存放
- ✅ **更专业**：符合开源项目规范
- ✅ **更易维护**：新手也能快速上手

现在项目已经准备好推送到 GitHub 了！🚀
